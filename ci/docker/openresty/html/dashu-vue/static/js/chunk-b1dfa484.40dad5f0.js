(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b1dfa484"],{"1f34":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-row",{attrs:{gutter:15}},[a("el-col",{attrs:{span:4}},[a("el-input",{staticStyle:{"margin-bottom":"10px"},attrs:{placeholder:"输入关键字进行过滤",size:"small"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),a("el-tree",{ref:"tree",staticClass:"filter-tree",attrs:{data:e.orgSelectTreeData,"expand-on-click-node":!1,"highlight-current":!0,props:{children:"children",label:"label"},"default-expand-all":"","filter-node-method":e.filterNode},on:{"node-click":e.treeNodeClick}})],1),a("el-col",{attrs:{span:20}},[a("el-switch",{staticStyle:{"margin-right":"10px"},attrs:{"active-value":"self","inactive-value":"notself",size:"small","active-text":"包含下级","inactive-text":"只查本级"},on:{change:e.getUserList},model:{value:e.searchData.isSelf,callback:function(t){e.$set(e.searchData,"isSelf",t)},expression:"searchData.isSelf"}}),a("el-input",{staticClass:"filter-item",staticStyle:{width:"125px","margin-right":"10px"},attrs:{size:"small",placeholder:"输入用户名查询"},model:{value:e.searchData.userName,callback:function(t){e.$set(e.searchData,"userName",t)},expression:"searchData.userName"}}),a("el-input",{staticClass:"filter-item",staticStyle:{width:"115px","margin-right":"10px"},attrs:{size:"small",placeholder:"输入姓名查询"},model:{value:e.searchData.name,callback:function(t){e.$set(e.searchData,"name",t)},expression:"searchData.name"}}),a("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-search",size:"small"},on:{click:e.searchBtnHandle}}),a("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"filter-item",attrs:{type:"info",icon:"el-icon-refresh",size:"small"},on:{click:e.resetTableList}},[e._v("重置 ")]),a("div",{staticStyle:{float:"right","margin-bottom":"10px"}},[a("el-button",{directives:[{name:"waves",rawName:"v-waves"},{name:"permission",rawName:"v-permission",value:"user-add",expression:"'user-add'"}],attrs:{type:"primary",size:"small",icon:"el-icon-plus"},on:{click:e.userAdd}},[e._v("新增 ")]),a("el-button",{directives:[{name:"waves",rawName:"v-waves"},{name:"permission",rawName:"v-permission",value:"reset-password",expression:"'reset-password'"}],attrs:{type:"warning",size:"small",icon:"el-icon-key"},on:{click:function(t){return e.resetPassword(null)}}},[e._v("重置密码 ")]),a("el-button",{directives:[{name:"waves",rawName:"v-waves"},{name:"permission",rawName:"v-permission",value:"user-delete",expression:"'user-delete'"}],attrs:{type:"danger",size:"small",icon:"el-icon-delete"},on:{click:function(t){return e.userDelete(null)}}},[e._v("删除 ")])],1),a("el-table",{ref:"dataTable",staticStyle:{width:"100%"},attrs:{data:e.userTable,"row-key":"userId",height:this.$windowHeight-230,border:""},on:{"selection-change":e.selectionChangeHandlerOrder}},[a("el-table-column",{attrs:{align:"center",type:"selection",width:"40"}}),a("el-table-column",{attrs:{align:"center",prop:"roleName",label:"角色","min-width":"10%"}}),a("el-table-column",{attrs:{align:"center",prop:"orgName",label:"部门","min-width":"10%"}}),a("el-table-column",{attrs:{align:"center",prop:"userName",label:"用户名","min-width":"8%"}}),a("el-table-column",{attrs:{align:"center",prop:"name",label:"姓名","min-width":"8%"}}),a("el-table-column",{attrs:{align:"center",prop:"nickName",label:"昵称","min-width":"8%"}}),a("el-table-column",{attrs:{align:"center",prop:"sex",label:"性别","min-width":"5%"},scopedSlots:e._u([{key:"default",fn:function(t){return["0"===t.row.sex?a("span",[e._v("未知")]):"1"===t.row.sex?a("span",[e._v("男")]):"2"===t.row.sex?a("span",[e._v("女")]):e._e()]}}])}),a("el-table-column",{attrs:{align:"center",prop:"status",label:"状态","min-width":"5%"},scopedSlots:e._u([{key:"default",fn:function(t){return["0"===t.row.status?a("span",{staticStyle:{color:"red"}},[e._v("禁用")]):a("span",{staticStyle:{color:"green"}},[e._v("正常")])]}}])}),a("el-table-column",{attrs:{align:"center",prop:"avatar",label:"头像",width:"121px"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.avatar?a("img",{staticStyle:{"max-width":"100px","max-height":"100px","object-fit":"cover"},attrs:{src:e.$baseServer+"/"+t.row.avatar}}):e._e(),t.row.avatar?e._e():a("span",[e._v("未上传")])]}}])}),a("el-table-column",{attrs:{align:"center",prop:"introduce",label:"简介","min-width":"10%"}}),a("el-table-column",{attrs:{fixed:"right",align:"center",label:"操作",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"trade-busTrade-update",expression:"'trade-busTrade-update'"}],attrs:{type:"text",size:"mini"},on:{click:function(a){return e.userUpdate(t.row)}}},[e._v("修改 ")]),a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"reset-password",expression:"'reset-password'"}],attrs:{type:"text",size:"mini"},on:{click:function(a){return e.resetPassword(t.row)}}},[e._v("重置密码 ")]),a("br"),"0"===t.row.status?a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"change-status",expression:"'change-status'"}],staticStyle:{color:"#13ce66"},attrs:{type:"text",size:"mini"},on:{click:function(a){return e.changeStatus(1,t.row)}}},[e._v("启用 ")]):a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"change-status",expression:"'change-status'"}],staticStyle:{color:"#ff6d6d"},attrs:{type:"text",size:"mini"},on:{click:function(a){return e.changeStatus(0,t.row)}}},[e._v("禁用 ")]),a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"trade-busTrade-delete",expression:"'trade-busTrade-delete'"}],staticStyle:{color:"#ff6d6d"},attrs:{type:"text",size:"mini"},on:{click:function(a){return e.userDelete(t.row)}}},[e._v("删除 ")])]}}])})],1),a("el-pagination",{staticStyle:{"text-align":"center","margin-top":"5px"},attrs:{background:"",layout:"total, pager","page-size":e.pager.limit,"current-page":e.pager.page,total:e.pager.totalCount},on:{"current-change":e.handleCurrentChange}})],1)],1),a("el-dialog",{attrs:{title:e.textMap[e.dialogStatus],top:"5vh",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"userDataForm",staticStyle:{width:"500px","margin-left":"50px"},attrs:{model:e.temp,rules:e.rules,"label-position":"right","label-width":"100px"}},[a("el-form-item",{attrs:{label:"用户名：",prop:"userName"}},[a("el-input",{attrs:{placeholder:"请输入用户名"},model:{value:e.temp.userName,callback:function(t){e.$set(e.temp,"userName",t)},expression:"temp.userName"}})],1),a("el-form-item",{attrs:{label:"所在部门：",prop:"orgId"}},[a("select-tree",{staticStyle:{width:"400px"},attrs:{"empty-text":"请选择所在部门","empty-value":"",props:{children:"children",label:"label"},data:e.orgSelectTreeData},model:{value:e.temp.orgId,callback:function(t){e.$set(e.temp,"orgId",t)},expression:"temp.orgId"}})],1),a("el-form-item",{attrs:{label:"角色：",prop:"roleId"}},[a("el-select",{staticClass:"filter-item",staticStyle:{width:"400px"},attrs:{multiple:!0,placeholder:"请选择角色"},model:{value:e.temp.roleId,callback:function(t){e.$set(e.temp,"roleId",t)},expression:"temp.roleId"}},e._l(e.roleNameOptions,(function(e){return a("el-option",{key:e.roleId,attrs:{label:e.roleName,value:e.roleId}})})),1)],1),a("el-form-item",{attrs:{label:"性别：",prop:"sex"}},[a("el-radio",{attrs:{label:"0"},model:{value:e.temp.sex,callback:function(t){e.$set(e.temp,"sex",t)},expression:"temp.sex"}},[e._v("未知")]),a("el-radio",{attrs:{label:"1"},model:{value:e.temp.sex,callback:function(t){e.$set(e.temp,"sex",t)},expression:"temp.sex"}},[e._v("男")]),a("el-radio",{attrs:{label:"2"},model:{value:e.temp.sex,callback:function(t){e.$set(e.temp,"sex",t)},expression:"temp.sex"}},[e._v("女")])],1),a("el-form-item",{attrs:{label:"昵称：",prop:"nickName"}},[a("el-input",{attrs:{placeholder:"请输入昵称"},model:{value:e.temp.nickName,callback:function(t){e.$set(e.temp,"nickName",t)},expression:"temp.nickName"}})],1),a("el-form-item",{attrs:{label:"简介：",prop:"introduce"}},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入简介"},model:{value:e.temp.introduce,callback:function(t){e.$set(e.temp,"introduce",t)},expression:"temp.introduce"}})],1),a("el-form-item",{attrs:{label:"头像：",prop:"avatar"}},[a("image-avatar",{attrs:{name:"avatar"},model:{value:e.temp.avatar,callback:function(t){e.$set(e.temp,"avatar",t)},expression:"temp.avatar"}})],1),a("el-form-item",{attrs:{label:"姓名：",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入姓名"},model:{value:e.temp.name,callback:function(t){e.$set(e.temp,"name",t)},expression:"temp.name"}})],1),a("el-form-item",{attrs:{label:"手机号：",prop:"phone"}},[a("el-input",{attrs:{placeholder:"请输入手机号"},model:{value:e.temp.phone,callback:function(t){e.$set(e.temp,"phone",t)},expression:"temp.phone"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.submitJudgment}},[e._v("保存")]),a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取消")])],1)],1)],1)},r=[],i=a("2909"),l=a("5530"),n=(a("ac1f"),a("00b4"),a("4de4"),a("d3b7"),a("e9c4"),a("14d9"),a("d81d"),a("c24f")),o=a("cc5e"),c=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-upload",{ref:"imageAvatar",staticClass:"avatar-uploader",attrs:{data:{path:e.path},name:e.name,action:""===e.action?e.$baseServer+"/upload/images":e.action,"show-file-list":!1,multiple:!1,"before-upload":e.imgBeforeUpload,"on-success":e.imgUploadSuccess,accept:"image/*"}},[e.dialogImageUrl?a("img",{staticClass:"avatar",attrs:{src:e.dialogImageUrl}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1)},u=[],p=(a("a9e3"),a("3ca3"),a("ddb0"),a("2b3d"),a("9861"),a("5494"),a("4d63"),a("c607"),a("2c3e"),a("25f0"),{name:"ImageAvatar",props:{value:{type:String,default:""},name:{type:String,default:"filename"},action:{type:String,default:""},path:{type:String,default:""},limitSize:{type:Number,default:1024}},data:function(){return{dialogImageUrl:""}},watch:{value:function(){this.loadImg()}},mounted:function(){this.loadImg()},methods:{loadImg:function(){null!==this.value&&""!==this.value?this.dialogImageUrl=this.$baseServer+this.value:this.dialogImageUrl=""},imgUploadSuccess:function(e,t,a){this.$emit("input",e.data[0].fileUrl),this.dialogImageUrl=URL.createObjectURL(t.raw)},imgBeforeUpload:function(e){var t=e.size/1024<this.limitSize;if(!t){var a=this.limitSize+"KB";this.limitSize>=1024&&(a=this.limitSize/1024+"MB"),this.$message.error("文件大小超过 "+a)}var s=new RegExp("image/*").test(e.type);return s||this.$message.error("请选择正确的图片！"),t&&s}}}),d=p,m=(a("8a26"),a("2877")),h=Object(m["a"])(d,c,u,!1,null,null,null),g=h.exports,f=a("b775"),b=a("fb36"),v=a("6724"),w={components:{ImageAvatar:g,SelectTree:b["a"]},directives:{waves:v["a"]},data:function(){return{userTable:[],pager:{page:1,limit:10,totalCount:0},searchData:{},roleNameOptions:[],textMap:{update:"修改",create:"新增"},dialogStatus:"",dialogFormVisible:!1,changeData:[],userIds:[],temp:{},rules:{userName:[{required:!0,message:"请填写用户名",trigger:"blur"}],password:[{required:!0,message:"请填写密码",trigger:"blur"}],roleId:[{required:!0,message:"请给用户选择角色",trigger:"blur"}],phone:[{required:!1,trigger:"blur",validator:function(e,t,a){t&&!/^(?:(?:\+|00)86)?1\d{10}$/.test(t)?a("手机号格式不正确"):a()}}]},orgSelectTreeData:[],filterText:"",leftTreeData:[]}},watch:{filterText:function(e){this.$refs.tree.filter(e)}},created:function(){this.loadOrgTreeForSelect(),this.getUserList(),this.getRoleList()},methods:{filterNode:function(e,t){return!e||-1!==t.label.indexOf(e)},treeNodeClick:function(e){this.searchData.orgId=e.value,this.getUserList()},selectionChangeHandlerOrder:function(e){this.changeData=e},resetTemp:function(){this.temp={userName:"",orgId:"",roleId:[],password:"",sex:"0",nickName:"",introduce:"",avatar:"",name:"",phone:""}},searchBtnHandle:function(){this.pager.page=1,this.getUserList()},resetTableList:function(){this.pager.page=1,this.searchData={},this.getUserList()},getUserList:function(){var e=this,t=Object(l["a"])(Object(l["a"])({},this.pager),{},{params:JSON.stringify(this.searchData)});Object(n["b"])(t).then((function(t){e.userTable=t.data.records,e.pager.totalCount=t.data.total}))},handleCurrentChange:function(e){this.pager.page=e,this.getUserList()},getRoleList:function(){var e=this;Object(o["e"])().then((function(t){e.roleNameOptions=t.data.records}))},userAdd:function(){var e=this;this.resetTemp(),this.dialogFormVisible=!0,this.dialogStatus="create",this.$nextTick((function(){e.$refs["userDataForm"].clearValidate(),e.loadOrgTreeForSelect()}))},userUpdate:function(e){var t=this;e&&(this.$refs.dataTable.clearSelection(),this.$refs.dataTable.toggleRowSelection(e,!0)),this.changeData.length<=0?this.$message({type:"warning",message:"请选择一条数据进行修改！"}):this.changeData.length>1?this.$message({type:"warning",message:"修改时，只允许选择一条数据！"}):(this.temp=Object.assign({},this.changeData[0]),this.temp.roleId=this.changeData[0].roleId?this.changeData[0].roleId.split(","):[],this.dialogStatus="update",this.dialogFormVisible=!0,this.$nextTick((function(){t.$refs["userDataForm"].clearValidate(),t.loadOrgTreeForSelect()})))},loadOrgTreeForSelect:function(){var e=this;Object(f["a"])({url:"/user/org/tree",method:"get"}).then((function(t){e.orgSelectTreeData=t.data}))},submitJudgment:function(){var e=this;this.$refs["userDataForm"].validate((function(t){t&&("update"===e.dialogStatus?Object(n["i"])(e.temp).then((function(t){e.$message({type:"success",message:"修改成功！"}),e.dialogFormVisible=!1,e.getUserList()})):Object(n["f"])(e.temp).then((function(t){e.$message({type:"success",message:"添加成功！"}),e.dialogFormVisible=!1,e.getUserList()})))}))},userDelete:function(e){var t=this;e&&(this.$refs.dataTable.clearSelection(),this.$refs.dataTable.toggleRowSelection(e,!0)),this.changeData.length<=0?this.$message({message:"请选择一条数据删除！",type:"warning"}):this.$confirm("确定要删除吗?","删除提醒",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var e;t.userIds=[],(e=t.userIds).push.apply(e,Object(i["a"])(t.changeData.map((function(e){return e.userId})))),Object(n["g"])(t.userIds).then((function(e){t.$message({type:"success",message:"删除成功！"}),t.getUserList()}))}))},resetPassword:function(e){var t=this;e&&(this.$refs.dataTable.clearSelection(),this.$refs.dataTable.toggleRowSelection(e,!0)),this.changeData.length<=0?this.$message({message:"至少选择一个用户重置密码！",type:"error"}):this.$confirm("确定要重置密码吗?","重置密码提醒",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var e;t.userIds=[],(e=t.userIds).push.apply(e,Object(i["a"])(t.changeData.map((function(e){return e.userId})))),console.log(t.userIds),Object(n["h"])(t.userIds).then((function(e){t.$message({type:"success",message:"重置密码成功！"}),t.getUserList()}))}))},changeStatus:function(e,t){var a=this;t&&(this.$refs.dataTable.clearSelection(),this.$refs.dataTable.toggleRowSelection(t,!0));var s=0===e?"禁用":"启用";if(this.changeData.length<=0)this.$message({message:"至少选择一个用户"+s+"！",type:"error"});else{var r;this.userIds=[],(r=this.userIds).push.apply(r,Object(i["a"])(this.changeData.map((function(e){return e.userId}))));var l={userIds:this.userIds,status:e};Object(f["a"])({url:"/user/change/status",method:"post",data:l}).then((function(e){a.$message({type:"success",message:"用户"+s+"成功！"}),a.getUserList()}))}}}},x=w,y=Object(m["a"])(x,s,r,!1,null,null,null);t["default"]=y.exports},"4f58":function(e,t,a){},"8a26":function(e,t,a){"use strict";a("4f58")},cc5e:function(e,t,a){"use strict";a.d(t,"e",(function(){return r})),a.d(t,"g",(function(){return i})),a.d(t,"a",(function(){return l})),a.d(t,"c",(function(){return n})),a.d(t,"b",(function(){return o})),a.d(t,"d",(function(){return c})),a.d(t,"f",(function(){return u}));var s=a("b775");function r(){return Object(s["a"])({url:"/role/list",method:"get"})}function i(e){return Object(s["a"])({url:"/role/update",method:"post",data:e})}function l(e){return Object(s["a"])({url:"/role/add",method:"post",data:e})}function n(e){return Object(s["a"])({url:"/role/delete",method:"delete",data:e})}function o(e){return Object(s["a"])({url:"/role/copy",method:"post",params:e})}function c(e){return Object(s["a"])({url:"/permission/listForRole",method:"get",params:e})}function u(e){return Object(s["a"])({url:"/role/permission/saveRolePermission",method:"post",data:e})}},d2c9:function(e,t,a){"use strict";a("ef3a")},ef3a:function(e,t,a){},fb36:function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-select",{ref:"selectTree",staticClass:"main-select-tree",model:{value:e.selectValue,callback:function(t){e.selectValue=t},expression:"selectValue"}},[a("el-option",{key:e.emptyValue,attrs:{label:e.emptyText,value:e.emptyValue}}),e._l(e.options,(function(e){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],key:e.value,attrs:{label:e.label,value:e.value}})})),a("el-tree",{ref:"selectElTree",staticClass:"main-select-el-tree",attrs:{data:e.data,"current-node-key":e.selectValue,"node-key":"value","highlight-current":"",props:e.props,"expand-on-click-node":!1,"default-expand-all":""},on:{"node-click":e.handleNodeClick}})],2)},r=[],i=(a("d3b7"),a("159b"),a("14d9"),{name:"select-tree",props:{value:{type:String,default:""},emptyValue:{type:String,default:""},emptyText:{type:String,default:"请选择"},name:{type:String,default:""},data:{type:Array,default:[]},props:{type:Object,default:{children:"children",label:"label"}}},data:function(){return{selectValue:"",options:[]}},mounted:function(){this.selectValue=this.value},watch:{data:function(){this.options=[],this.formatOptions(this.data)},selectValue:function(){this.$emit("input",this.selectValue)},value:function(){this.selectValue=this.value}},methods:{formatOptions:function(e){var t=this;e.forEach((function(e,a){t.options.push({label:e.label,value:e.value}),e.children&&t.formatOptions(e.children)}))},handleNodeClick:function(e){this.selectValue=e.value,this.$refs.selectTree.blur()}}}),l=i,n=(a("d2c9"),a("2877")),o=Object(n["a"])(l,s,r,!1,null,null,null);t["a"]=o.exports}}]);